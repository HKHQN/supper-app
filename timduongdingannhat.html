<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thuáº­t toÃ¡n Dijkstra - ÄÆ°á»ng Ä‘i ngáº¯n nháº¥t</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .graph-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      max-width: 1400px;
      margin: 0 auto;
    }

    canvas {
      display: block;
      width: 100%;
      height: auto;
      background: #f8fafc;
      border-radius: 12px;
      cursor: pointer;
    }

    .node {
      transition: all 0.3s ease;
    }

    .btn {
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .result-card {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .modal {
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
    }

    .input-field {
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
  </style>
</head>
<body>
  <div class="graph-container">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold mb-2">ğŸ“Š Thuáº­t toÃ¡n Dijkstra</h1>
          <p class="opacity-90">TÃ¬m Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t tá»« má»™t Ä‘á»‰nh Ä‘áº¿n táº¥t cáº£ cÃ¡c Ä‘á»‰nh cÃ²n láº¡i</p>
        </div>
        <div class="flex gap-2">
          <button id="themeToggle" class="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition">
            ğŸŒ“ Cháº¿ Ä‘á»™ tá»‘i
          </button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="p-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Canvas Area -->
        <div class="lg:col-span-2">
          <div class="bg-gray-50 rounded-xl p-4 shadow-inner">
            <canvas id="graphCanvas" width="1000" height="600"></canvas>
          </div>

          <!-- Control Buttons -->
          <div class="flex flex-wrap gap-3 mt-4">
            <button id="addNodeBtn" class="btn bg-green-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-green-600 flex items-center gap-2">
              <span class="text-xl">â•</span> ThÃªm Ä‘á»‰nh
            </button>
            <button id="addEdgeBtn" class="btn bg-blue-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-600 flex items-center gap-2">
              <span class="text-xl">ğŸ”—</span> ThÃªm cáº¡nh
            </button>
            <button id="runDijkstraBtn" class="btn bg-purple-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-purple-600 flex items-center gap-2">
              <span class="text-xl">â–¶ï¸</span> Cháº¡y Dijkstra
            </button>
            <button id="resetBtn" class="btn bg-red-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-red-600 flex items-center gap-2">
              <span class="text-xl">ğŸ”„</span> Reset
            </button>
          </div>
        </div>

        <!-- Right Panel -->
        <div class="space-y-6">
          <!-- Node List -->
          <div class="bg-white rounded-xl shadow-lg p-5">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
              <span class="w-2 h-8 bg-purple-500 rounded-full"></span>
              Danh sÃ¡ch Ä‘á»‰nh
            </h2>
            <div id="nodeList" class="space-y-2 max-h-60 overflow-y-auto"></div>
          </div>

          <!-- Dijkstra Controls -->
          <div class="bg-white rounded-xl shadow-lg p-5">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
              <span class="w-2 h-8 bg-blue-500 rounded-full"></span>
              Äiá»u khiá»ƒn Dijkstra
            </h2>
            <div class="space-y-4">
              <select id="sourceNode" class="input-field w-full p-3 rounded-lg">
                <option value="">Chá»n Ä‘á»‰nh nguá»“n...</option>
              </select>
              <button id="visualizeBtn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition">
                ğŸ¯ TÃ¬m Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t
              </button>
            </div>
          </div>

          <!-- Results -->
          <div class="bg-white rounded-xl shadow-lg p-5">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
              <span class="w-2 h-8 bg-green-500 rounded-full"></span>
              Káº¿t quáº£
            </h2>
            <div id="resultContainer" class="space-y-3 max-h-80 overflow-y-auto"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal fixed inset-0 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl transform transition-all">
      <h3 id="modalTitle" class="text-2xl font-bold mb-6 text-gray-800">ThÃªm Ä‘á»‰nh má»›i</h3>
      <form id="nodeForm" class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">TÃªn Ä‘á»‰nh</label>
          <input type="text" id="nodeName" maxlength="3" class="input-field w-full p-3 rounded-lg" placeholder="VD: A, B, 1, 2..." required>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Tá»a Ä‘á»™ X</label>
            <input type="number" id="nodeX" min="50" max="950" value="200" class="input-field w-full p-3 rounded-lg">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Tá»a Ä‘á»™ Y</label>
            <input type="number" id="nodeY" min="50" max="550" value="200" class="input-field w-full p-3 rounded-lg">
          </div>
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" id="cancelModal" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Há»§y</button>
          <button type="submit" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-600 hover:to-emerald-600 transition">LÆ°u</button>
        </div>
      </form>

      <form id="edgeForm" class="space-y-5 hidden">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Äá»‰nh báº¯t Ä‘áº§u</label>
          <select id="edgeFrom" class="input-field w-full p-3 rounded-lg" required>
            <option value="">Chá»n Ä‘á»‰nh...</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Äá»‰nh káº¿t thÃºc</label>
          <select id="edgeTo" class="input-field w-full p-3 rounded-lg" required>
            <option value="">Chá»n Ä‘á»‰nh...</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Trá»ng sá»‘</label>
          <input type="number" id="edgeWeight" min="1" max="100" value="1" class="input-field w-full p-3 rounded-lg" required>
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" id="cancelEdgeModal" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Há»§y</button>
          <button type="submit" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:from-blue-600 hover:to-cyan-600 transition">ThÃªm cáº¡nh</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Graph data structure
    class Graph {
      constructor() {
        this.nodes = new Map(); // nodeId -> {x, y, label}
        this.edges = new Map(); // edgeId -> {from, to, weight}
        this.adjacencyList = new Map(); // nodeId -> [{to, weight, edgeId}]
      }

      addNode(id, x, y, label) {
        if (this.nodes.has(id)) return false;
        this.nodes.set(id, { x, y, label });
        this.adjacencyList.set(id, []);
        return true;
      }

      removeNode(id) {
        if (!this.nodes.has(id)) return;
        
        // Remove all edges connected to this node
        const edgesToRemove = [];
        this.edges.forEach((edge, edgeId) => {
          if (edge.from === id || edge.to === id) {
            edgesToRemove.push(edgeId);
          }
        });
        edgesToRemove.forEach(edgeId => this.removeEdge(edgeId));
        
        this.nodes.delete(id);
        this.adjacencyList.delete(id);
      }

      addEdge(from, to, weight) {
        if (!this.nodes.has(from) || !this.nodes.has(to)) return null;
        if (from === to) return null;
        
        const edgeId = `${from}-${to}-${Date.now()}`;
        this.edges.set(edgeId, { from, to, weight });
        
        // Add to adjacency list (undirected graph)
        this.adjacencyList.get(from).push({ to, weight, edgeId });
        this.adjacencyList.get(to).push({ to: from, weight, edgeId });
        
        return edgeId;
      }

      removeEdge(edgeId) {
        if (!this.edges.has(edgeId)) return;
        
        const edge = this.edges.get(edgeId);
        
        // Remove from adjacency lists
        this.adjacencyList.set(edge.from, 
          this.adjacencyList.get(edge.from).filter(e => e.edgeId !== edgeId));
        this.adjacencyList.set(edge.to, 
          this.adjacencyList.get(edge.to).filter(e => e.edgeId !== edgeId));
        
        this.edges.delete(edgeId);
      }

      dijkstra(startId) {
        if (!this.nodes.has(startId)) return null;

        const distances = new Map();
        const previous = new Map();
        const unvisited = new Set(this.nodes.keys());
        
        // Initialize
        this.nodes.forEach((_, id) => {
          distances.set(id, Infinity);
          previous.set(id, null);
        });
        distances.set(startId, 0);

        while (unvisited.size > 0) {
          // Find node with minimum distance
          let minNode = null;
          let minDist = Infinity;
          unvisited.forEach(id => {
            if (distances.get(id) < minDist) {
              minDist = distances.get(id);
              minNode = id;
            }
          });

          if (minNode === null || minDist === Infinity) break;
          unvisited.delete(minNode);

          // Update neighbors
          const neighbors = this.adjacencyList.get(minNode) || [];
          neighbors.forEach(neighbor => {
            if (unvisited.has(neighbor.to)) {
              const alt = distances.get(minNode) + neighbor.weight;
              if (alt < distances.get(neighbor.to)) {
                distances.set(neighbor.to, alt);
                previous.set(neighbor.to, minNode);
              }
            }
          });
        }

        return { distances, previous };
      }

      getPath(previous, target) {
        const path = [];
        let current = target;
        while (current !== null) {
          path.unshift(current);
          current = previous.get(current);
        }
        return path;
      }

      clear() {
        this.nodes.clear();
        this.edges.clear();
        this.adjacencyList.clear();
      }

      toJSON() {
        return {
          nodes: Array.from(this.nodes.entries()),
          edges: Array.from(this.edges.entries())
        };
      }

      loadFromJSON(data) {
        this.clear();
        data.nodes.forEach(([id, node]) => this.addNode(id, node.x, node.y, node.label));
        data.edges.forEach(([edgeId, edge]) => this.addEdge(edge.from, edge.to, edge.weight));
      }
    }

    // Main application
    const graph = new Graph();
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');
    const modal = document.getElementById('modal');
    const nodeForm = document.getElementById('nodeForm');
    const edgeForm = document.getElementById('edgeForm');
    
    let mode = 'view'; // 'view', 'add-node', 'add-edge'
    let selectedNode = null;
    let highlightedPath = [];
    let darkMode = false;

    // Initialize with sample data
    function initializeSample() {
      graph.clear();
      graph.addNode('A', 200, 200, 'A');
      graph.addNode('B', 400, 150, 'B');
      graph.addNode('C', 600, 250, 'C');
      graph.addNode('D', 500, 400, 'D');
      graph.addNode('E', 300, 350, 'E');
      
      graph.addEdge('A', 'B', 4);
      graph.addEdge('A', 'E', 7);
      graph.addEdge('B', 'C', 3);
      graph.addEdge('B', 'E', 2);
      graph.addEdge('C', 'D', 5);
      graph.addEdge('D', 'E', 4);
      
      updateUI();
      draw();
    }

    // Drawing functions
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw grid (for better visualization)
      ctx.strokeStyle = darkMode ? '#334155' : '#e2e8f0';
      ctx.lineWidth = 1;
      for (let i = 0; i < canvas.width; i += 50) {
        ctx.beginPath();
        ctx.moveTo(i, 0);
        ctx.lineTo(i, canvas.height);
        ctx.strokeStyle = darkMode ? '#334155' : '#e2e8f0';
        ctx.stroke();
      }
      for (let i = 0; i < canvas.height; i += 50) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(canvas.width, i);
        ctx.stroke();
      }

      // Draw edges
      graph.edges.forEach(edge => {
        const fromNode = graph.nodes.get(edge.from);
        const toNode = graph.nodes.get(edge.to);
        if (!fromNode || !toNode) return;

        const isHighlighted = highlightedPath.some((node, index) => 
          index < highlightedPath.length - 1 && 
          ((node === edge.from && highlightedPath[index + 1] === edge.to) ||
           (node === edge.to && highlightedPath[index + 1] === edge.from))
        );

        ctx.beginPath();
        ctx.moveTo(fromNode.x, fromNode.y);
        ctx.lineTo(toNode.x, toNode.y);
        ctx.strokeStyle = isHighlighted ? '#f59e0b' : (darkMode ? '#94a3b8' : '#64748b');
        ctx.lineWidth = isHighlighted ? 4 : 2;
        ctx.stroke();

        // Draw weight
        const midX = (fromNode.x + toNode.x) / 2;
        const midY = (fromNode.y + toNode.y) / 2;
        
        ctx.fillStyle = darkMode ? '#f1f5f9' : '#1e293b';
        ctx.font = 'bold 14px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        // Background for weight
        ctx.fillStyle = darkMode ? '#1e293b' : '#ffffff';
        ctx.fillRect(midX - 15, midY - 12, 30, 24);
        
        ctx.fillStyle = darkMode ? '#f1f5f9' : '#1e293b';
        ctx.fillText(edge.weight, midX, midY);
      });

      // Draw nodes
      graph.nodes.forEach((node, id) => {
        ctx.beginPath();
        ctx.arc(node.x, node.y, 25, 0, Math.PI * 2);
        
        // Node color
        if (id === selectedNode) {
          ctx.fillStyle = '#f59e0b';
        } else if (highlightedPath.includes(id)) {
          ctx.fillStyle = '#10b981';
        } else {
          ctx.fillStyle = darkMode ? '#3b82f6' : '#3b82f6';
        }
        
        ctx.fill();
        ctx.strokeStyle = darkMode ? '#ffffff' : '#1e293b';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Node label
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 16px Arial';
        ctx.fillText(node.label, node.x, node.y);
      });

      // Mode indicator
      if (mode === 'add-node') {
        ctx.fillStyle = darkMode ? '#ffffff' : '#000000';
        ctx.font = '14px Arial';
        ctx.fillText('ğŸ–±ï¸ Cháº¿ Ä‘á»™ thÃªm Ä‘á»‰nh: Click vÃ o vá»‹ trÃ­ muá»‘n thÃªm', 20, 30);
      } else if (mode === 'add-edge') {
        ctx.fillStyle = darkMode ? '#ffffff' : '#000000';
        ctx.font = '14px Arial';
        ctx.fillText('ğŸ”— Cháº¿ Ä‘á»™ thÃªm cáº¡nh: Click vÃ o Ä‘á»‰nh báº¯t Ä‘áº§u vÃ  káº¿t thÃºc', 20, 30);
      }
    }

    // Update UI lists
    function updateUI() {
      // Update node list
      const nodeList = document.getElementById('nodeList');
      nodeList.innerHTML = '';
      
      if (graph.nodes.size === 0) {
        nodeList.innerHTML = '<p class="text-gray-500 text-center py-4">ChÆ°a cÃ³ Ä‘á»‰nh nÃ o</p>';
      } else {
        graph.nodes.forEach((node, id) => {
          const nodeDiv = document.createElement('div');
          nodeDiv.className = 'bg-gray-50 rounded-lg p-3 flex justify-between items-center hover:bg-gray-100 transition';
          nodeDiv.innerHTML = `
            <div>
              <span class="font-bold text-lg mr-2">${node.label}</span>
              <span class="text-sm text-gray-500">(${node.x}, ${node.y})</span>
            </div>
            <div class="flex gap-2">
              <button onclick="window.editNode('${id}')" class="text-blue-500 hover:text-blue-700 px-2">âœï¸</button>
              <button onclick="window.deleteNode('${id}')" class="text-red-500 hover:text-red-700 px-2">ğŸ—‘ï¸</button>
            </div>
          `;
          nodeList.appendChild(nodeDiv);
        });
      }

      // Update source select
      const sourceSelect = document.getElementById('sourceNode');
      sourceSelect.innerHTML = '<option value="">Chá»n Ä‘á»‰nh nguá»“n...</option>';
      graph.nodes.forEach((node, id) => {
        const option = document.createElement('option');
        option.value = id;
        option.textContent = node.label;
        sourceSelect.appendChild(option);
      });

      // Update edge form selects
      const edgeFrom = document.getElementById('edgeFrom');
      const edgeTo = document.getElementById('edgeTo');
      edgeFrom.innerHTML = '<option value="">Chá»n Ä‘á»‰nh...</option>';
      edgeTo.innerHTML = '<option value="">Chá»n Ä‘á»‰nh...</option>';
      
      graph.nodes.forEach((node, id) => {
        const option1 = document.createElement('option');
        option1.value = id;
        option1.textContent = node.label;
        edgeFrom.appendChild(option1.cloneNode(true));
        
        const option2 = document.createElement('option');
        option2.value = id;
        option2.textContent = node.label;
        edgeTo.appendChild(option2);
      });
    }

    // Event Handlers
    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      
      const x = (e.clientX - rect.left) * scaleX;
      const y = (e.clientY - rect.top) * scaleY;

      // Find clicked node
      let clickedNode = null;
      graph.nodes.forEach((node, id) => {
        const dx = node.x - x;
        const dy = node.y - y;
        if (dx * dx + dy * dy < 625) { // 25^2 radius
          clickedNode = id;
        }
      });

      if (mode === 'add-node') {
        // Add node at click position
        const id = prompt('Nháº­p tÃªn Ä‘á»‰nh (tá»‘i Ä‘a 3 kÃ½ tá»±):', '');
        if (id && id.length <= 3) {
          if (graph.addNode(id.toUpperCase(), x, y, id.toUpperCase())) {
            updateUI();
            draw();
          } else {
            alert('TÃªn Ä‘á»‰nh Ä‘Ã£ tá»“n táº¡i!');
          }
        }
      } else if (mode === 'add-edge') {
        if (clickedNode) {
          if (!selectedNode) {
            selectedNode = clickedNode;
            draw();
          } else if (selectedNode !== clickedNode) {
            const weight = prompt('Nháº­p trá»ng sá»‘:', '1');
            if (weight && !isNaN(weight) && weight > 0) {
              graph.addEdge(selectedNode, clickedNode, parseInt(weight));
              selectedNode = null;
              mode = 'view';
              updateUI();
              draw();
            }
          } else {
            selectedNode = null;
            mode = 'view';
            draw();
          }
        }
      } else if (clickedNode) {
        selectedNode = clickedNode;
        draw();
      }
    });

    // Button handlers
    document.getElementById('addNodeBtn').addEventListener('click', () => {
      mode = 'add-node';
      selectedNode = null;
      draw();
    });

    document.getElementById('addEdgeBtn').addEventListener('click', () => {
      if (graph.nodes.size < 2) {
        alert('Cáº§n Ã­t nháº¥t 2 Ä‘á»‰nh Ä‘á»ƒ thÃªm cáº¡nh!');
        return;
      }
      mode = 'add-edge';
      selectedNode = null;
      draw();
    });

    document.getElementById('runDijkstraBtn').addEventListener('click', () => {
      const source = document.getElementById('sourceNode').value;
      if (!source) {
        alert('Vui lÃ²ng chá»n Ä‘á»‰nh nguá»“n!');
        return;
      }

      const result = graph.dijkstra(source);
      if (!result) return;

      const { distances, previous } = result;
      
      // Display results
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML = '<h3 class="font-bold mb-3">ğŸ“Š Káº¿t quáº£ tá»« Ä‘á»‰nh ' + graph.nodes.get(source).label + ':</h3>';
      
      graph.nodes.forEach((node, id) => {
        const dist = distances.get(id);
        const path = graph.getPath(previous, id);
        
        const resultCard = document.createElement('div');
        resultCard.className = 'result-card';
        
        if (dist === Infinity) {
          resultCard.innerHTML = `
            <div class="font-semibold">${node.label}</div>
            <div class="text-sm opacity-90">âŒ KhÃ´ng thá»ƒ Ä‘áº¿n Ä‘Æ°á»£c</div>
          `;
        } else {
          resultCard.innerHTML = `
            <div class="font-semibold">${node.label}</div>
            <div class="text-sm opacity-90">ğŸ“ Khoáº£ng cÃ¡ch: ${dist}</div>
            <div class="text-sm opacity-90">ğŸ›£ï¸ ÄÆ°á»ng Ä‘i: ${path.map(p => graph.nodes.get(p).label).join(' â†’ ')}</div>
          `;
        }
        
        resultContainer.appendChild(resultCard);
      });

      // Highlight path to selected node (if any)
      if (selectedNode) {
        highlightedPath = graph.getPath(previous, selectedNode);
      }
      draw();
    });

    document.getElementById('visualizeBtn').addEventListener('click', () => {
      document.getElementById('runDijkstraBtn').click();
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      if (confirm('XÃ³a táº¥t cáº£ dá»¯ liá»‡u?')) {
        graph.clear();
        selectedNode = null;
        highlightedPath = [];
        mode = 'view';
        updateUI();
        draw();
      }
    });

    // Modal handlers
    document.getElementById('addNodeBtn').addEventListener('click', () => {
      document.getElementById('modalTitle').textContent = 'â• ThÃªm Ä‘á»‰nh má»›i';
      nodeForm.classList.remove('hidden');
      edgeForm.classList.add('hidden');
      modal.classList.remove('hidden');
    });

    document.getElementById('addEdgeBtn').addEventListener('click', () => {
      if (graph.nodes.size < 2) {
        alert('Cáº§n Ã­t nháº¥t 2 Ä‘á»‰nh!');
        return;
      }
      document.getElementById('modalTitle').textContent = 'ğŸ”— ThÃªm cáº¡nh má»›i';
      nodeForm.classList.add('hidden');
      edgeForm.classList.remove('hidden');
      modal.classList.remove('hidden');
    });

    nodeForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('nodeName').value.toUpperCase().trim();
      const x = parseInt(document.getElementById('nodeX').value);
      const y = parseInt(document.getElementById('nodeY').value);
      
      if (graph.addNode(name, x, y, name)) {
        modal.classList.add('hidden');
        nodeForm.reset();
        updateUI();
        draw();
      } else {
        alert('TÃªn Ä‘á»‰nh Ä‘Ã£ tá»“n táº¡i!');
      }
    });

    edgeForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const from = document.getElementById('edgeFrom').value;
      const to = document.getElementById('edgeTo').value;
      const weight = parseInt(document.getElementById('edgeWeight').value);
      
      if (from && to && weight > 0) {
        if (from === to) {
          alert('KhÃ´ng thá»ƒ táº¡o cáº¡nh tá»« má»™t Ä‘á»‰nh Ä‘áº¿n chÃ­nh nÃ³!');
          return;
        }
        graph.addEdge(from, to, weight);
        modal.classList.add('hidden');
        edgeForm.reset();
        updateUI();
        draw();
      }
    });

    document.getElementById('cancelModal').addEventListener('click', () => {
      modal.classList.add('hidden');
      nodeForm.reset();
    });

    document.getElementById('cancelEdgeModal').addEventListener('click', () => {
      modal.classList.add('hidden');
      edgeForm.reset();
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
        nodeForm.reset();
        edgeForm.reset();
      }
    });

    // Delete functions
    window.deleteNode = (id) => {
      if (confirm(`XÃ³a Ä‘á»‰nh ${graph.nodes.get(id).label}?`)) {
        graph.removeNode(id);
        if (selectedNode === id) selectedNode = null;
        highlightedPath = [];
        updateUI();
        draw();
      }
    };

    window.editNode = (id) => {
      const node = graph.nodes.get(id);
      const newLabel = prompt('Nháº­p tÃªn má»›i cho Ä‘á»‰nh:', node.label);
      if (newLabel && newLabel.length <= 3) {
        const newX = prompt('Nháº­p tá»a Ä‘á»™ X (50-950):', node.x);
        const newY = prompt('Nháº­p tá»a Ä‘á»™ Y (50-550):', node.y);
        
        if (newX && newY) {
          graph.nodes.set(id, { 
            x: parseInt(newX), 
            y: parseInt(newY), 
            label: newLabel.toUpperCase() 
          });
          updateUI();
          draw();
        }
      }
    };

    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', () => {
      darkMode = !darkMode;
      document.body.style.background = darkMode ? 
        'linear-gradient(135deg, #1e293b 0%, #0f172a 100%)' : 
        'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      draw();
    });

    // Initialize
    initializeSample();
  </script>
</body>
</html>
