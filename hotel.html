<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Qu·∫£n l√Ω Nh√† ngh·ªâ - Kh√°ch s·∫°n - Qu√°n h√°t</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { primary: '#3b82f6' } } }
    }
  </script>
  <!-- Firebase SDK v9 modular -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, update, remove, push } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    window.firebaseApp = initializeApp({
      databaseURL: "https://supperdatabase-default-rtdb.firebaseio.com/"
    });
    window.db = getDatabase(window.firebaseApp);
  </script>
  <style>
    .modal { display: none; }
    .modal.active { display: flex; }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors">

  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 shadow sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-primary">Qu·∫£n l√Ω C∆° s·ªü L∆∞u tr√∫ & Qu√°n h√°t</h1>
      <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
        üåô
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-semibold">Danh s√°ch c∆° s·ªü</h2>
      <button id="addBtn" class="bg-primary text-white px-6 py-2 rounded-lg shadow hover:bg-blue-700 transition">
        + Th√™m m·ªõi
      </button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-xl shadow">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">T√™n</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Lo·∫°i</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">ƒê·ªãa ch·ªâ</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">SƒêT</th>
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Gi√° (VNƒê)</th>
            <th class="px-6 py-3 text-center text-xs font-medium uppercase tracking-wider">H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody id="placeList" class="divide-y divide-gray-200 dark:divide-gray-700">
          <!-- Data s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- Modal Form -->
  <div id="modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 transition-opacity">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full mx-4 p-6 transform transition-all scale-95">
      <h3 id="modalTitle" class="text-xl font-bold mb-4">Th√™m c∆° s·ªü m·ªõi</h3>
      <form id="placeForm">
        <input type="hidden" id="editId" />

        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">T√™n c∆° s·ªü</label>
          <input type="text" id="name" required class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary" />
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Lo·∫°i</label>
          <select id="type" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600">
            <option value="Nh√† ngh·ªâ">Nh√† ngh·ªâ</option>
            <option value="Kh√°ch s·∫°n">Kh√°ch s·∫°n</option>
            <option value="Qu√°n h√°t / Karaoke">Qu√°n h√°t / Karaoke</option>
          </select>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">ƒê·ªãa ch·ªâ</label>
          <input type="text" id="address" required class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600" />
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">S·ªë ƒëi·ªán tho·∫°i</label>
          <input type="tel" id="phone" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600" />
        </div>

        <div class="mb-6">
          <label class="block text-sm font-medium mb-1">Gi√° tham kh·∫£o (VNƒê/ƒë√™m ho·∫∑c gi·ªù)</label>
          <input type="number" id="price" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="VD: 300000" />
        </div>

        <div class="flex justify-end gap-3">
          <button type="button" id="cancelBtn" class="px-5 py-2 border rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">H·ªßy</button>
          <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">L∆∞u</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    import { ref, onValue, set, update, remove, push } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const db = window.db;
    const placesRef = ref(db, 'places');

    const placeList = document.getElementById('placeList');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const form = document.getElementById('placeForm');
    const editIdInput = document.getElementById('editId');
    const addBtn = document.getElementById('addBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const themeToggle = document.getElementById('themeToggle');

    // Theme toggle
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
      themeToggle.textContent = '‚òÄÔ∏è';
    } else {
      themeToggle.textContent = 'üåô';
    }

    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      themeToggle.textContent = document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
    });

    // Load & listen realtime
    onValue(placesRef, (snapshot) => {
      placeList.innerHTML = '';
      const data = snapshot.val();
      if (!data) {
        placeList.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y th√™m m·ªõi!</td></tr>';
        return;
      }

      Object.entries(data).forEach(([id, place]) => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition';
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap font-medium">${place.name || '-'}</td>
          <td class="px-6 py-4 whitespace-nowrap">${place.type || '-'}</td>
          <td class="px-6 py-4">${place.address || '-'}</td>
          <td class="px-6 py-4">${place.phone || '-'}</td>
          <td class="px-6 py-4">${place.price ? place.price.toLocaleString('vi-VN') : '-'}</td>
          <td class="px-6 py-4 text-center">
            <button onclick="editPlace('${id}')" class="text-blue-600 hover:underline mr-3">S·ª≠a</button>
            <button onclick="deletePlace('${id}')" class="text-red-600 hover:underline">X√≥a</button>
          </td>
        `;
        placeList.appendChild(row);
      });
    });

    // Open modal for add
    addBtn.onclick = () => {
      form.reset();
      editIdInput.value = '';
      modalTitle.textContent = 'Th√™m c∆° s·ªü m·ªõi';
      modal.classList.add('active');
    };

    // Close modal
    cancelBtn.onclick = () => modal.classList.remove('active');
    modal.onclick = (e) => { if (e.target === modal) modal.classList.remove('active'); };

    // Save (Add or Update)
    form.onsubmit = (e) => {
      e.preventDefault();
      const id = editIdInput.value;
      const newData = {
        name: document.getElementById('name').value.trim(),
        type: document.getElementById('type').value,
        address: document.getElementById('address').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        price: Number(document.getElementById('price').value) || 0
      };

      if (!newData.name || !newData.address) {
        alert('Vui l√≤ng ƒëi·ªÅn t√™n v√† ƒë·ªãa ch·ªâ!');
        return;
      }

      if (id) {
        // Update
        update(ref(db, `places/${id}`), newData);
      } else {
        // Add new (push t·∫°o key t·ª± ƒë·ªông)
        push(placesRef, newData);
      }

      modal.classList.remove('active');
      alert(id ? 'C·∫≠p nh·∫≠t th√†nh c√¥ng!' : 'Th√™m m·ªõi th√†nh c√¥ng!');
    };

    // Edit
    window.editPlace = (id) => {
      onValue(ref(db, `places/${id}`), (snap) => {
        const place = snap.val();
        if (!place) return;

        editIdInput.value = id;
        document.getElementById('name').value = place.name || '';
        document.getElementById('type').value = place.type || 'Nh√† ngh·ªâ';
        document.getElementById('address').value = place.address || '';
        document.getElementById('phone').value = place.phone || '';
        document.getElementById('price').value = place.price || '';

        modalTitle.textContent = 'S·ª≠a th√¥ng tin c∆° s·ªü';
        modal.classList.add('active');
      }, { onlyOnce: true });
    };

    // Delete
    window.deletePlace = (id) => {
      if (!confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a?')) return;
      remove(ref(db, `places/${id}`));
      alert('X√≥a th√†nh c√¥ng!');
    };
  </script>
</body>
</html>